<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø´Ø§Ø´â€ŒØ´Ù…Ø§Ø± â€” Mini App</title>

  <!-- Inline styles (no external CSS) -->
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#10b981;--danger:#ff7043;--text:#e6eef8}
    html,body{height:100%;margin:0;font-family:Tahoma,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071126 0%, #071a2a 100%);color:var(--text);display:flex;align-items:center;justify-content:center;padding:20px}
    .wrap{width:100%;max-width:720px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    h1{margin:0 0 10px;font-size:20px;text-align:center}
    p.hint{margin:6px 0 18px;text-align:center;color:#bcd3e6}
    .btns{display:grid;grid-template-columns:1fr;gap:10px}
    .btn{padding:14px;border-radius:10px;border:0;font-size:16px;cursor:pointer;box-shadow:0 4px 12px rgba(2,6,23,0.5)}
    .btn:active{transform:translateY(1px)}
    .btn.pee{background:linear-gradient(90deg,#14b8a6,#06b6d4);color:#042028}
    .btn.shit{background:linear-gradient(90deg,#ff7043,#ff8a65);color:#2b0700}
    .btn.board{background:linear-gradient(90deg,#4f46e5,#3b82f6);color:white}
    .status{margin-top:14px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);text-align:center;color:#d7eaf6;font-size:14px}
    .hidden{display:none}
    /* fallback for not inside Telegram */
    .not-tg{border:1px dashed rgba(255,255,255,0.06);padding:12px;border-radius:8px;margin-top:12px;color:#ffd1d1;background:rgba(255,0,0,0.02)}
    small.note{display:block;margin-top:8px;color:#a7c0d8}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="appCard">
      <h1>Ø´Ø§Ø´â€ŒØ´Ù…Ø§Ø± â€” Mini App</h1>
      <p class="hint">Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø³Ø±ÛŒØ¹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† â€” Ù‡Ù…Ù‡â€ŒÚ†ÛŒØ² Ø¯Ø§Ø®Ù„ ØªÙ„Ú¯Ø±Ø§Ù… Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>

      <div class="btns" id="controls">
        <button class="btn pee" id="btnPee">ğŸš½ Ø´Ø§Ø´ÛŒØ¯Ù…</button>
        <button class="btn shit" id="btnShit">ğŸ’© Ø±ÛŒØ¯Ù…</button>
        <button class="btn board" id="btnBoard">ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù…Ø±ÙˆØ²</button>
      </div>

      <div id="status" class="status hidden"></div>

      <div id="notTg" class="not-tg hidden">
        <strong>ØªØ°Ú©Ø±:</strong> Ø§ÛŒÙ† Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¨Ø§ÛŒØ¯ <em>Ø¯Ø§Ø®Ù„ ØªÙ„Ú¯Ø±Ø§Ù…</em> Ø¨Ø§Ø² Ø´ÙˆØ¯ ØªØ§ Ø¹Ù…Ù„ Ú©Ù†Ø¯.<br>
        Ø§Ú¯Ø± Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯ÛŒØŒ Ø§Ø² Ø¨Ø§Øª Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… Ø¯Ú©Ù…Ù‡â€ŒÛŒ ÙˆØ¨â€ŒØ§Ù¾ Ø±Ø§ ÙØ´Ø§Ø± Ø¨Ø¯Ù‡ ÛŒØ§ Ø§Ø² Ø¯Ø³ØªÙˆØ± Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†:
        <small class="note">Ø¯Ø± Ø±Ø¨Ø§Øª ØªØ§ÛŒÙ¾ Ú©Ù†: <code>/startapp</code> Ùˆ Ø¨Ø¹Ø¯ Ø¯Ú©Ù…Ù‡ ÙˆØ¨â€ŒØ§Ù¾ Ø±Ø§ Ø¨Ø²Ù†</small>
      </div>
    </div>
  </div>

  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    (function(){
      const statusEl = document.getElementById('status');
      const notTgEl = document.getElementById('notTg');
      const isInsideTelegram = !!window.Telegram && !!window.Telegram.WebApp;
      let tg = isInsideTelegram ? window.Telegram.WebApp : null;

      function showStatus(msg, short=true){
        statusEl.classList.remove('hidden');
        statusEl.textContent = msg;
        if(!short){
          // keep visible
        }
        setTimeout(()=>{ statusEl.classList.add('hidden'); }, 3500);
      }

      // If not inside Telegram, show fallback
      if(!isInsideTelegram){
        notTgEl.classList.remove('hidden');
      } else {
        try{
          tg.expand(); // request fullscreen
          tg.ready();
        }catch(e){
          console.warn("tg init:", e);
        }
      }

      // Helpers to send data back to bot
      function sendAction(action){
        if(!isInsideTelegram){
          // fallback: just show message locally
          showStatus('ØªØ³Øª: ' + action, false);
          console.log('Would send:', action);
          return;
        }
        const payload = { action: action, ts: Date.now() };
        try{
          tg.sendData(JSON.stringify(payload));
          showStatus('Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ âœ…');
          // Optionally close the webapp after send:
          // setTimeout(()=>tg.close(), 800);
        }catch(err){
          console.error('sendData error', err);
          showStatus('Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯ âŒ');
        }
      }

      // wire buttons
      document.getElementById('btnPee').addEventListener('click', ()=> sendAction('pee'));
      document.getElementById('btnShit').addEventListener('click', ()=> sendAction('shit'));
      document.getElementById('btnBoard').addEventListener('click', ()=> sendAction('leaderboard'));

      // optional: handle back/close events
      if(isInsideTelegram){
        tg.onEvent('themeChanged', ()=>{ /* you can respond to theme */ });
      }
    })();
  </script>
  <script>
window.onerror = function(message, source, lineno, colno, error) {
    document.body.innerHTML = "<pre style='color:red'>" + message + "</pre>";
};
</script>
</body>
</html>
